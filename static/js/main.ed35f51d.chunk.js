(this["webpackJsonpsubscription-contract"]=this["webpackJsonpsubscription-contract"]||[]).push([[0],{156:function(t){t.exports=JSON.parse('{"a":[{"inputs":[{"internalType":"uint256","name":"_baseValue","type":"uint256"},{"internalType":"uint256","name":"_durationInMinutes","type":"uint256"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":false,"internalType":"uint256","name":"subscribedAt","type":"uint256"}],"name":"SubscriptionSuccess","type":"event"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"subscribers","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"subscriptionBaseValue","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"subscriptionDuration","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"subscribe","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"subscriberAddress","type":"address"}],"name":"getDataOfSubscriber","outputs":[{"components":[{"internalType":"bool","name":"subscribed","type":"bool"},{"internalType":"uint256","name":"payedAmount","type":"uint256"},{"internalType":"uint256","name":"subscribedAt","type":"uint256"}],"internalType":"struct Subscription.Subscriber","name":"data","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getSubscriptionData","outputs":[{"components":[{"internalType":"bool","name":"subscribed","type":"bool"},{"internalType":"uint256","name":"payedAmount","type":"uint256"},{"internalType":"uint256","name":"subscribedAt","type":"uint256"}],"internalType":"struct Subscription.Subscriber","name":"data","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getAllSubscribers","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"remove","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"withdraw","outputs":[],"stateMutability":"nonpayable","type":"function"}],"b":{"4":{"events":{},"links":{},"address":"0x9969fa17995E0Bc0e6b068ca4e42f5f96B7F1208","transactionHash":"0x8180e68a91538ad3803590c9e524d163dd84aab2d2d81255cf76fe1dea72c6c2"},"5777":{"events":{},"links":{},"address":"0xDa2570a8Fbd1292b2B55E661FBad1E776D895981","transactionHash":"0xd6fd22a7371fbef0e291ef57d2749fc3d3505453d4e5033101358b9abe9cce0b"}}}')},264:function(t,e,n){},266:function(t,e,n){},282:function(t,e){},285:function(t,e){},286:function(t,e){},290:function(t,e){},291:function(t,e){},317:function(t,e){},319:function(t,e){},333:function(t,e){},335:function(t,e){},351:function(t,e){},370:function(t,e){},372:function(t,e){},390:function(t,e){},391:function(t,e){},461:function(t,e){},463:function(t,e){},469:function(t,e){},481:function(t,e){},484:function(t,e){},489:function(t,e){},577:function(t,e,n){},580:function(t,e,n){},582:function(t,e,n){},583:function(t,e,n){"use strict";n.r(e);var r=n(0),a=n.n(r),c=n(42),s=n.n(c),i=(n(264),n(11)),u=n(109),o=n(13),b=n(21),d=n(9),l=n.n(d),p=n(589),f=n(588),j=n(113),h=n.p+"static/media/metamask.09e5f554.svg",m=(n(266),n(1)),x=function(){return Object(m.jsx)("img",{src:h,alt:"MetaMask"})},O=n(6),v=n(7),y=function(){function t(e,n,r){Object(O.a)(this,t),this.contractInstance=void 0,this.contractInstance=new e.eth.Contract(n,r)}return Object(v.a)(t,[{key:"subscribe",value:function(){var t=Object(b.a)(l.a.mark((function t(e,n){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.contractInstance.methods.subscribe().send({from:e,value:n}));case 1:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getBalance",value:function(){var t=Object(b.a)(l.a.mark((function t(e){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.contractInstance.methods.getBalance().call({from:e}));case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"withdraw",value:function(){var t=Object(b.a)(l.a.mark((function t(e){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.contractInstance.methods.withdraw().send({from:e}));case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"remove",value:function(){var t=Object(b.a)(l.a.mark((function t(e){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.contractInstance.methods.remove().send({from:e}));case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getSubscriptionData",value:function(){var t=Object(b.a)(l.a.mark((function t(e){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.contractInstance.methods.getSubscriptionData().call({from:e}));case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getDataOfSubscriber",value:function(){var t=Object(b.a)(l.a.mark((function t(e,n){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.contractInstance.methods.getDataOfSubscriber(n).call({from:e}));case 1:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getAllSubscribers",value:function(){var t=Object(b.a)(l.a.mark((function t(e){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.contractInstance.methods.getAllSubscribers().call({from:e}));case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getAllContractData",value:function(){var t=Object(b.a)(l.a.mark((function t(e){var n,r,a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.contractInstance.methods.owner().call({from:e});case 2:return n=t.sent,t.next=5,this.contractInstance.methods.subscriptionBaseValue().call({from:e});case 5:return r=t.sent,t.next=8,this.contractInstance.methods.subscriptionDuration().call({from:e});case 8:return a=t.sent,t.abrupt("return",{owner:n,subscriptionValue:r,subscriptionDuration:a});case 10:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"onSubscriptionSuccess",value:function(t,e){var n={};t&&(n={from:t}),this.contractInstance.events.SubscriptionSuccess({filter:n}).on("data",e)}},{key:"offSubscriptionSuccess",value:function(t,e){var n={};t&&(n={from:t}),this.contractInstance.events.SubscriptionSuccess({filter:n}).off("data",e)}}]),t}(),w=function(t,e,n){var a=Object(r.useState)(new y(t,e,n));return Object(i.a)(a,1)[0]},S=n(250),C=n.n(S),g=function(){var t=Object(r.useState)(""),e=Object(i.a)(t,2),n=e[0],a=e[1],c=Object(r.useState)(new C.a(window.ethereum)),s=Object(i.a)(c,1)[0],u=function(){var t=Object(b.a)(l.a.mark((function t(){var e;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.eth.requestAccounts();case 2:e=t.sent,a(e.length?e[0]:"");case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(r.useEffect)((function(){var t=function(t){a(t.length?t[0]:"")},e=function(){var t=Object(b.a)(l.a.mark((function t(){var e;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.eth.getAccounts();case 2:if((e=t.sent).length){t.next=5;break}return t.abrupt("return");case 5:a(e[0]);case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return s&&(s.currentProvider.on("accountsChanged",t),e()),function(){s.currentProvider.off("accountsChanged",t)}}),[s]),{web3:s,account:n,connectToMetaMask:u}},k=n(156),D=k.b[4].address,T=a.a.createContext(void 0),A=a.a.createContext(void 0),I=a.a.createContext(""),E=function(t){var e=g(),n=e.web3,r=e.account,a=e.connectToMetaMask,c=w(n,k.a,D);return Object(m.jsx)(I.Provider,{value:r,children:Object(m.jsx)(A.Provider,{value:a,children:Object(m.jsx)(T.Provider,{value:c,children:t.children})})})};function M(){var t=a.a.useContext(T);if(void 0===t)throw new Error("useSubscriptionContext must be used within an SmartContractContextProvider");return t}function N(){var t=a.a.useContext(I);if(void 0===t)throw new Error("useAccount must be used within an SmartContractContextProvider");return t}var B;n(577);!function(t){t.Disconnected="DISCONNECTED",t.Connected="CONNECTED",t.Succeeded="SUCCEEDED"}(B||(B={}));var P=function(t){var e=t.onSuccess,n=Object(r.useState)(B.Disconnected),c=Object(i.a)(n,2),s=c[0],u=c[1],d=Object(r.useState)(!1),h=Object(i.a)(d,2),O=h[0],v=h[1],y=function(){var t=a.a.useContext(A);if(void 0===t)throw new Error("useMetaMask must be used within an SmartContractContextProvider");return t}(),w=N(),S=Object(o.h)(),C=M();Object(r.useEffect)((function(){var t=function(){var t=Object(b.a)(l.a.mark((function t(){var e,n,r,a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(w&&C){t.next=3;break}return u(B.Disconnected),t.abrupt("return");case 3:return t.next=5,C.getAllContractData(w);case 5:return e=t.sent,n=e.owner,v(n.toUpperCase()===w.toUpperCase()),t.next=10,C.getSubscriptionData(w);case 10:r=t.sent,a=r.subscribed,u(a?B.Succeeded:B.Connected);case 13:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();t()}),[w,C]),Object(r.useEffect)((function(){s===B.Succeeded&&e(O)}),[s,O,e]);var g=function(t){var e=t.returnValues,n=e.from,r=e.subscribedAt;console.log({event:t.event,from:n,subscribedAt:r}),u(B.Succeeded)};Object(r.useEffect)((function(){return C.onSubscriptionSuccess(w,g),function(){C.offSubscriptionSuccess(w,g)}}),[C,w]);var k=function(){var t=Object(b.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,y();case 2:u(B.Connected);case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),D=function(){var t=Object(b.a)(l.a.mark((function t(){var e,n,r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,C.getAllContractData(w);case 2:return e=t.sent,n=e.subscriptionValue,t.next=6,C.getSubscriptionData(w);case 6:if(r=t.sent,!r.subscribed){t.next=12;break}u(B.Succeeded),t.next=14;break;case 12:return t.next=14,C.subscribe(w,n);case 14:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),T=function(){var t=Object(b.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:S("/");case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),I=function(){var t=Object(b.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:S("/admin");case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(m.jsxs)(p.a,{show:!0,centered:!0,children:[Object(m.jsx)(p.a.Header,{children:Object(m.jsx)(p.a.Title,{children:"Connect your wallet and subscribe!"})}),Object(m.jsxs)(p.a.Body,{children:["Contribute with just ",Object(m.jsx)("b",{children:"0.01 ETH"})," and get access to awesome content."]}),Object(m.jsxs)(p.a.Footer,{className:"d-flex justify-content-center",children:[s===B.Disconnected&&Object(m.jsxs)(f.a,{variant:"primary",onClick:k,className:"d-flex",children:[Object(m.jsx)(x,{}),Object(m.jsx)("div",{children:"Connect with MetaMask"})]}),s===B.Connected&&Object(m.jsxs)(m.Fragment,{children:["Connected with wallet ",Object(m.jsx)("b",{children:w}),Object(m.jsx)(f.a,{variant:"secondary",onClick:D,className:"d-flex",children:Object(m.jsx)("div",{children:"Subscribe Now!!"})})]}),s===B.Succeeded&&Object(m.jsxs)(m.Fragment,{children:["Connected with wallet ",Object(m.jsx)("b",{children:w}),Object(m.jsx)(f.a,{variant:"secondary",onClick:T,className:"d-flex",children:Object(m.jsx)("div",{children:"Access Site"})}),Object(m.jsxs)(f.a,{variant:"primary",onClick:I,className:"d-flex align-items-center",disabled:!O,children:[Object(m.jsx)(j.b,{}),Object(m.jsx)("div",{children:"Admin Page"})]})]})]})]})},F=function(t){return t.authCondition?Object(m.jsx)(o.b,{}):Object(m.jsx)(o.a,{to:"/login"})},V=n(591),H=n(590),L=(n(580),function(){var t=N(),e=M(),n=Object(r.useState)({owner:"",subscriptionValue:0,subscriptionDuration:0}),a=Object(i.a)(n,2),c=a[0],s=a[1],u=Object(r.useState)(0),o=Object(i.a)(u,2),d=o[0],p=o[1],h=Object(r.useState)(0),x=Object(i.a)(h,2),O=x[0],v=x[1],y=Object(r.useState)([]),w=Object(i.a)(y,2),S=w[0],C=w[1],g=Object(r.useCallback)(Object(b.a)(l.a.mark((function n(){var r,a,c,i,u;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.getAllContractData(t);case 2:return r=n.sent,n.next=5,e.getSubscriptionData(t);case 5:return a=n.sent,c=a.subscribedAt,n.next=9,e.getBalance(t);case 9:return i=n.sent,n.next=12,e.getAllSubscribers(t);case 12:u=n.sent,p(c),s(r),v(i),C(u);case 17:case"end":return n.stop()}}),n)}))),[t,e]);Object(r.useEffect)((function(){return g(),e.onSubscriptionSuccess("",g),function(){e.offSubscriptionSuccess("",g)}}),[t,e,g]);var k=function(){var n=Object(b.a)(l.a.mark((function n(){return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.withdraw(t);case 2:g();case 3:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();return Object(m.jsxs)(V.a,{border:"dark",style:{width:"32rem"},children:[Object(m.jsx)(V.a.Header,{children:"Contract Information"}),Object(m.jsxs)(V.a.Body,{children:[Object(m.jsxs)(V.a.Title,{children:["Balance: ",O," WEI"]}),Object(m.jsxs)(V.a.Subtitle,{className:"mb-2 text-muted",children:["Cration date: ",new Date(Number(1e3*d)).toLocaleString()]}),Object(m.jsxs)(V.a.Subtitle,{className:"mb-2 text-muted",children:["# of subscribers: ",S.length]}),Object(m.jsxs)(V.a.Subtitle,{className:"mb-2 text-muted",children:["Subscription price: ",c.subscriptionValue," WEI"]}),Object(m.jsxs)(V.a.Subtitle,{className:"mb-2 text-muted",children:["Subscription duration: ",c.subscriptionDuration/60," min"]})]}),Object(m.jsxs)(V.a.Body,{children:[Object(m.jsx)(V.a.Text,{className:"text-muted",children:"Subscribers"}),Object(m.jsx)(H.a,{variant:"flush",className:"subscriber-list",children:S.map((function(t){return Object(m.jsx)(H.a.Item,{className:"text-muted",children:t},t)}))})]}),Object(m.jsx)(V.a.Body,{children:Object(m.jsxs)(f.a,{variant:"primary",onClick:k,className:"d-flex align-items-center",children:[Object(m.jsx)(j.a,{}),Object(m.jsx)("div",{children:"Withdraw"})]})})]})}),W=function(){var t=N(),e=M(),n=Object(r.useState)({subscribed:!1,payedAmount:0,subscribedAt:0}),a=Object(i.a)(n,2),c=a[0],s=a[1],u=Object(r.useState)({owner:"",subscriptionValue:0,subscriptionDuration:0}),o=Object(i.a)(u,2),d=o[0],p=o[1];return Object(r.useEffect)((function(){var n=function(){var n=Object(b.a)(l.a.mark((function n(){var r,a;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.getAllContractData(t);case 2:return r=n.sent,n.next=5,e.getSubscriptionData(t);case 5:a=n.sent,s(a),p(r);case 8:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();n()}),[t,e]),Object(m.jsxs)(V.a,{border:"dark",style:{width:"32rem"},children:[Object(m.jsx)(V.a.Header,{children:"Your subscription"}),Object(m.jsxs)(V.a.Body,{children:[Object(m.jsx)(V.a.Title,{children:t}),Object(m.jsxs)(H.a,{variant:"flush",children:[Object(m.jsxs)(H.a.Item,{children:[Object(m.jsx)("b",{children:"Payed amount:"})," ",c.payedAmount," WEI"]}),Object(m.jsxs)(H.a.Item,{children:[Object(m.jsx)("b",{children:"Valid From:"})," ",new Date(Number(1e3*c.subscribedAt)).toLocaleString()]}),Object(m.jsxs)(H.a.Item,{children:[Object(m.jsx)("b",{children:"To:"})," ",new Date(1e3*(Number(c.subscribedAt)+Number(d.subscriptionDuration))).toLocaleString()]})]})]})]})},J=(n(582),function(){var t=N(),e=Object(r.useState)(!1),n=Object(i.a)(e,2),a=n[0],c=n[1],s=Object(r.useState)(!1),b=Object(i.a)(s,2),d=b[0],l=b[1];return Object(r.useEffect)((function(){c(!1),l(!1)}),[t]),Object(m.jsx)("div",{className:"app",children:Object(m.jsx)(u.a,{children:Object(m.jsxs)(o.e,{children:[Object(m.jsx)(o.c,{path:"/login",element:Object(m.jsx)(P,{onSuccess:function(t){l(!0),c(t)}})}),Object(m.jsx)(o.c,{path:"/admin",element:Object(m.jsx)(F,{authCondition:a}),children:Object(m.jsx)(o.c,{path:"/admin",element:Object(m.jsx)(L,{})})}),Object(m.jsx)(o.c,{path:"/",element:Object(m.jsx)(F,{authCondition:d}),children:Object(m.jsx)(o.c,{path:"/",element:Object(m.jsx)(W,{})})})]})})})}),U=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,592)).then((function(e){var n=e.getCLS,r=e.getFID,a=e.getFCP,c=e.getLCP,s=e.getTTFB;n(t),r(t),a(t),c(t),s(t)}))};s.a.render(Object(m.jsx)(a.a.StrictMode,{children:Object(m.jsx)(E,{children:Object(m.jsx)(J,{})})}),document.getElementById("root")),U()}},[[583,1,2]]]);
//# sourceMappingURL=main.ed35f51d.chunk.js.map